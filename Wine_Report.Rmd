---
title: "Wine Quality Report"
author: "Ben Aoki-Sherwood and Hugh Shanno"
date: "2023-02-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(GGally)
library(patchwork)
library(broom)
```

```{r}
wine <- read.csv("https://www.math.carleton.edu/ckelling/data/wine_project.csv")
names(wine)
wine <- wine %>% mutate(index = row_number())
```

Check for covariance
```{r}
ggpairs(wine)
```

fit a basic model and examine VIF
```{r}
basic.wine.lm <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol + color, data = wine)
vif(basic.wine.lm)
```

Examine t and F tests for basic model
```{r}
anova(basic.wine.lm)
summary(basic.wine.lm)
```

remove outliers:
  -max sugar outlier has max leverage
  -total SO2 outlier has max std.resid

```{r}
aug_basic <- augment(basic.wine.lm, data = wine)
slice_max(wine, residual.sugar) # try removing sugar outlier: max leverage
wine_removed <- wine %>% filter(!(index %in% c(4381, 6345)))
```

```{r}
ggpairs(wine_removed)
```

```{r}
wine.reparam <- wine_removed %>%
  mutate(bound.sulfur.dioxide = total.sulfur.dioxide - free.sulfur.dioxide)

#Create new model with bound sulfur dioxide instead of total sulfur dioxide
new.basic.wine.lm <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + bound.sulfur.dioxide + density + pH + sulphates + alcohol + color, data = wine.reparam)
```

```{r}
vif(new.basic.wine.lm)
```
Create new model without density and check VIF
```{r}
density.dropped.lm <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + bound.sulfur.dioxide + pH + sulphates + alcohol + color, data = wine.reparam)
vif(density.dropped.lm)
```
Check assumptions
```{r}
resid_xpanel(density.dropped.lm, smoother = TRUE)
```
Log chlorides, check using F-test if adding quadratic term for free sulfur dioxide is significant
```{r}
chlorides.lm <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + log(chlorides) + free.sulfur.dioxide + bound.sulfur.dioxide + pH + sulphates + alcohol + color, data = wine.reparam)
quad.sulfur.lm <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + log(chlorides) + free.sulfur.dioxide + I(free.sulfur.dioxide^2) + bound.sulfur.dioxide + pH + sulphates + alcohol + color, data = wine.reparam)
anova(chlorides.lm, quad.sulfur.lm)
```
Check confidence intervals of latest model
```{r}
confint(quad.sulfur.lm)
```
Check if fixed acidity and citric acid have any effect on model significance
```{r}
less.acidity.lm <- lm(quality ~ volatile.acidity + residual.sugar + log(chlorides) + free.sulfur.dioxide + I(free.sulfur.dioxide^2) + bound.sulfur.dioxide + pH + sulphates + alcohol + color, data = wine.reparam)
anova(less.acidity.lm, quad.sulfur.lm)
AIC(less.acidity.lm)
AIC(quad.sulfur.lm)
#Conclude that neither acidity measure has an effect on the model
```
Check for interactions with color
```{r}
wine.interactions.lm <- lm(quality ~ (volatile.acidity + residual.sugar + log(chlorides) + free.sulfur.dioxide + I(free.sulfur.dioxide^2) + bound.sulfur.dioxide + pH + sulphates + alcohol)*color, data = wine.reparam)
#Check sums of squares of interaction terms
anova(wine.interactions.lm)
#Select highest sums of squares terms: free sulfur dioxide and pH (interactions)
```

Add in interaction with free sulfur dioxide and color, check to see if pH and color is a significant interaction
```{r}
small.inter.wine.lm <- lm(quality ~ volatile.acidity + residual.sugar + log(chlorides) + free.sulfur.dioxide*color + I(free.sulfur.dioxide^2) + bound.sulfur.dioxide + pH + sulphates + alcohol, data = wine.reparam)
big.inter.wine.lm <- lm(quality ~ volatile.acidity + residual.sugar + log(chlorides) + free.sulfur.dioxide*color + I(free.sulfur.dioxide^2) + bound.sulfur.dioxide + pH*color + sulphates + alcohol, data = wine.reparam)
anova(small.inter.wine.lm,big.inter.wine.lm)
AIC(small.inter.wine.lm)
AIC(big.inter.wine.lm)
#Conclude that pH and color interaction is significant
#Both AICs are better than no interaction model
```

Check AIC, coefficients, and confidence intervals of model
```{r}
AIC(big.inter.wine.lm)
summary(big.inter.wine.lm)
confint(big.inter.wine.lm)
#Confidence intervals suggest that all coefficients have significant effect
```
Finally, check model assumptions
```{r}
resid_panel(big.inter.wine.lm, plots=c("resid","qq"))
#Even distribution in predicted values residual plot, qq is pretty straight (maybe slightly heavy tailed)
```


```{r}
resid_xpanel(big.inter.wine.lm)
#Scatters look generally linear, random, and homoskedastic
```


